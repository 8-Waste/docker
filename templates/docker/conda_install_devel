# This is needed for numpy 1.16 to use numpy __array_function__ overrides,
# which are known to be needed for dask_cudf
ENV NUMPY_EXPERIMENTAL_ARRAY_FUNCTION=1

RUN source activate rapids \
    && env \
    && pip install sphinx-markdown-tables \
    && conda list \
    # FIXME: Base image should have correct blas version and blas uninstall/install here
    #        should be removed
    && conda uninstall -y blas openblas \
    && conda install -y -n rapids --freeze-installed --override-channels \
      -c rapidsai \
      -c rapidsai-nightly \
      -c nvidia \
      -c conda-forge \
      boost-cpp=${BOOST_CPP_VERSION} \
      cmake=${CMAKE_VERSION} \
      cmake_setuptools">=0.1.3" \
      rapidsai::cupy \
      double-conversion \
      dlpack \
      flatbuffers \
      hypothesis \
      rapidsai::libclang \
      libcypher-parser \
      libgfortran-ng=${LIBGFORTRAN_NG_VERSION} \
      lapack \
      liblapack \
      make \
      numba=${NUMBA_VERSION} \
      numpy=${NUMPY_VERSION} \
      pandas=${PANDAS_VERSION} \
      pytest \
      rapidjson \
      conda-forge::blas==1.1=openblas \
      sphinx sphinx_rtd_theme numpydoc sphinxcontrib-websupport nbsphinx recommonmark doxygen "pandoc<=2.0.0" \
    && conda clean -afy \
    && chmod -R ugo+w /opt/conda
