COPY supportfiles/.condarc /opt/conda/.condarc

# Env debug info
RUN source activate rapids \
    && env \
    && conda info \
    && conda config --show-sources \
    && conda list --show-channel-urls

# Setup rapids build env from conda meta-pkg
RUN ${RAPIDS_DIR}/utils/condaretry install -y -n rapids --freeze-installed rapids-build-env

# Install pkgs for doc builds
RUN ${RAPIDS_DIR}/utils/condaretry install -y -n rapids --freeze-installed \
        sphinx \
        sphinx_rtd_theme \
        numpydoc \
        sphinxcontrib-websupport \
        nbsphinx \
        recommonmark \
        doxygen \
        "pandoc<=2.0.0" \
        ucx-py \
    && pip install sphinx-markdown-tables

# Clean up and set permissions on conda install
RUN conda clean -afy \
    && chmod -R ugo+w /opt/conda

# Env debug info
RUN source activate rapids \
    && env \
    && conda info \
    && conda config --show-sources \
    && conda list --show-channel-urls
