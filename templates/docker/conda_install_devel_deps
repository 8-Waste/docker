COPY supportfiles/.condarc /opt/conda/.condarc

# Setup rapids build env from conda meta-pkg
RUN ${RAPIDS_DIR}/utils/condaretry install -y --freeze-installed rapids-build-env \
    && source activate rapids \
    && env \
    && pip install sphinx-markdown-tables \
    && conda info \
    && conda config --show-sources \
    && conda list --show-channel-urls

# Install only deps for rapids meta-pkg
RUN ${RAPIDS_DIR}/utils/condaretry install -y -n rapids --freeze-installed --only-deps \
    rapids=${RAPIDS_CONDA_VERSION_SPEC}

# Install pkgs for doc builds
RUN ${RAPIDS_DIR}/utils/condaretry install -y -n rapids --freeze-installed \
         sphinx \
         sphinx_rtd_theme \
         numpydoc \
         sphinxcontrib-websupport \
         nbsphinx \
         recommonmark \
         doxygen \
         "pandoc<=2.0.0" \
         ucx-py \

# Clean up and set permissions on conda install
RUN conda clean -afy \
    && chmod -R ugo+w /opt/conda
